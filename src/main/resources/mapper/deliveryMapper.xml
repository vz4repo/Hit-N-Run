<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.homerunball.delivery.dao.deliveryMapper">
    <!-- 51p. 모든 배송지 목록 -->
    <select id="selectAll" parameterType="int" resultType="DeliveryDto">
        SELECT c_adr_list_id, rcver, adr_name, rcver_phn, rcver_adr
        FROM cust_adr_list
        WHERE c_id = #{c_id}
        ORDER BY c_adr_list_id ASC
    </select>

    <!-- 50p, 55p. 주문페이지 선택한 배송지 띄우기 // 51p 에 선택도 이거 그대로 이용하면 될것같은데... -->
    <select id="select" parameterType="int" resultType="DeliveryDto">
        /* TODO : check - c_id 와 c_adr_list_id 는 update할때 필요해서 추가 */
        SELECT c_id, c_adr_list_id, rcver, adr_name, rcver_phn, rcver_adr
        <!-- 이후 배송메모(배송 요청사항)도 추가해야함 나중에... dlv 테이블 dlv_memo랑 조인 -->
        FROM cust_adr_list
        WHERE c_id = #{c_id} AND c_adr_list_id = #{c_adr_list_id}
        /* ⭐⭐⭐⭐ 물어보기 ⭐⭐⭐⭐*/
        /* 선택 배송지면 c_id랑 c_adr_list_id랑 같이 있어야 하는지, 아니면 c_id 는 다른 방법으로 받아 오는건지 모르겠음*/
        /* -> 같이 있는게 맞다. */
    </select>

    <!-- 51p. 신규 배송지 입력 -->
    <insert id="insert" parameterType="DeliveryDto">
        INSERT INTO cust_adr_list
            (c_id, adr_name, rcver, rcver_phn, rcver_zip, rcver_adr)
        VALUES
            (#{c_id}, #{adr_name}, #{rcver}, #{rcver_phn}, #{rcver_zip}, #{rcver_adr})
        /* ⭐⭐⭐⭐ 물어보기 ⭐⭐⭐⭐*/
        /* c_adr_list_id는 autoincrement로 처리되는데... 신규 배송지에 따로 입력해줄 필요는 없나?*/
        /*⭐⭐ 고객이 가지고있는 c_adr_list_id의 max함수를 써서 거기서 +1을 해서 직접 넣어주기 ⭐⭐*/
    </insert>

    <!-- 51p. 배송지 리스트 중 하나 선택해서 수정 -->
    <update id="update" parameterType="DeliveryDto">
        UPDATE cust_adr_list
        SET adr_name = #{adr_name}
          , rcver = #{rcver}
          , rcver_phn = #{rcver_phn}
          , rcver_zip = #{rcver_zip}
          , rcver_adr = #{rcver_adr}
        WHERE c_id = #{c_id} AND c_adr_list_id = #{c_adr_list_id}
    </update>
    <!-- TODO : 아무것도 입력 안하거나, 안했을때 자동으로 이전에 저장되어 있던 값일 뜨게 할 수 는 없나?? 그리고 c_id는 수정이 안되어야하는데... 그러려면 DaoImpl에서 Map으로 받아야하나? 현재는 dto 형태로 받음 -->
    <!-- => session 으로 값을 넘겨주면 된다. 민욱님 controller랑 jsp 참고.. -->
    <!-- 기존걸 읽어와서 그대로 업데이트를 하던가, 아니면 쿼릴르 여러개 놓던가, 기존쿼리를 읽어와서 수정 -->



    <!-- TODO : 이거 맞는지 검사받기 ! -->
    <!--  typealias 문제래서 일단 대문자 문제인줄알고 DeliveryDto 에서 deliveryDto로 변경  -->
    <!-- 51p. 기본 배송지 설정 // 고객 테이블에서 변경-->
    <update id="updateDefaultDlv" parameterType="deliveryDto">
        UPDATE cust a   /* cust 테이블에 */
        INNER JOIN cust_adr_list b  /* cust_adr_list_b 를 조인해서*/
        ON a.c_id = b.c_id  /* cust 테이블의 c_id 와 cust_adr_list 테이블의 c_id와 일치하는 row에서 */
        SET a.c_adr_list_id = b.c_adr_list_id   /* cust의 c_adr_list_id 를, c_adr_list 테이블의 c_adr_list_id 로 변경해준다.*/
    </update>



    <!-- 51p. 배송지 리스트 중 하나 삭제 -->
    <delete id="delete" parameterType="map">
        DELETE FROM cust_adr_list WHERE c_id = #{c_id} and c_adr_list_id = #{c_adr_list_id}
    </delete>


</mapper>
